<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>ðŸ”´Playing along</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles/bootstrap-4.6/bootstrap.css">
  <link rel="stylesheet" href="styles/bootstrap-4.6/bootstrap.custom.css">
  <link rel="stylesheet" href="styles/custom.css">

  <script type="module" src="./main.js"></script>
</head>

<body>
  <script>
    try {
      if (document.domain == 'athena.imuscica.eu') {
        console.log("[WBWB] Initial domain is: " + document.domain);
        document.domain = 'imuscica.eu';
        console.log("[WBWB] domain overwritten to: " + document.domain);
      }
      else {
        console.log("[WBWB] domain remained: " + document.domain);
      }
    }
    catch (e) {
      console.log("[WBWB] cannot overwrite domain.");
    }
  </script>

  <!-- workbench initialises audio manager -->
  <script type="text/javascript" src="/js/audioManager.js"></script>
  <!-- workbench also needs to initialise audio sources -->
  <script type="text/javascript" src="/js/audioSources.js"></script>
  <!-- workbench loads metronome -->
  <script type="text/javascript" src="/metronome_js/metronome.js"></script>
  <script type="text/javascript" src="/js/main.js"></script>

  <center>
    <h1>
      <font>Play along</font>
      <font color="red"> (use headphones while recording)</font>
    </h1>
    <div id="controls">
      <button id="recordButton" class="btn btn-lg" title="Record"><svg
          xmlns="http://www.w3.org/2000/svg" width="45" height="45" fill="red"
          class="bi bi-record-fill" viewBox="0 0 16 16">
          <path fill-rule="evenodd" d="M8 13A5 5 0 1 0 8 3a5 5 0 0 0 0 10z" />
        </svg></button>
      <button disabled id="pauseButton" class="btn btn-lg">
        <svg xmlns="http://www.w3.org/2000/svg" width="45" height="45" fill="currentColor"
          class="bi bi-pause-fill" viewBox="0 0 16 16">
          <path
            d="M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5zm5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5z" />
        </svg></button>
      <button id="stopButton" disabled class="btn btn-lg" title="">
        <svg xmlns="http://www.w3.org/2000/svg" width="45" height="45" fill="currentColor"
          class="bi bi-stop-fill" viewBox="0 0 16 16">
          <path
            d="M5 3.5h6A1.5 1.5 0 0 1 12.5 5v6a1.5 1.5 0 0 1-1.5 1.5H5A1.5 1.5 0 0 1 3.5 11V5A1.5 1.5 0 0 1 5 3.5z" />
        </svg></button>
      <button id="playpauseallButton" hidden class="btn btn-lg" title="">
        <svg xmlns="http://www.w3.org/2000/svg" width="45" height="45" fill="currentColor"
          class="bi bi-stop-fill" viewBox="0 0 16 16">
          <path
            d="M5 3.5h6A1.5 1.5 0 0 1 12.5 5v6a1.5 1.5 0 0 1-1.5 1.5H5A1.5 1.5 0 0 1 3.5 11V5A1.5 1.5 0 0 1 5 3.5z" />
        </svg></button>
      <button id="playallButton" hidden class="btn btn-lg" title="">
      </button>
      <button id="pauseallButton" hidden class="btn btn-lg" title="">
      </button>
      <button id="stopallButton" hidden class="btn btn-lg" title="Stop all">
        <svg xmlns="http://www.w3.org/2000/svg" width="45" height="45" fill="black"
          class="bi bi-skip-start-fill" viewBox="0 0 16 16">
          <path
            d="M4 4a.5.5 0 0 1 1 0v3.248l6.267-3.636c.54-.313 1.232.066 1.232.696v7.384c0 .63-.692 1.01-1.232.697L5 8.753V12a.5.5 0 0 1-1 0V4z" />
        </svg>
      </button>
      <button id="combineselectedButton" hidden class="btn btn-lg"
        title="Mix recordings and download">
        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor"
          class="bi bi-download" viewBox="0 0 16 16">
          <path
            d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z" />
          <path
            d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z" />
        </svg>
      </button>
    </div>
    <audio id="metronome" src="audio/metronome.wav"></audio>

    <div id="formats">Format: start recording to see sample rate</div>
    <div hidden>
      <label for="bpm">Enter BPM:</label>
      <input type="number" id="bpm" value="120">
      <button id="start_metro">Start</button>
      <button id="stop_metro">Stop</button>
    </div>
    <div>
      <iframe src="/apprepository/playalong-collab/metronome_iFrame.html" frameborder="0" scrolling="no" height="60px"
        width="100%"></iframe>
    </div>
    <div class="container">
      <form action="/action_page.php">
        <h5>
          <p></p>
          <label for="myfile">Audio track to follow:</label>
        </h5>
        <input type="file" id="file-input" />
      </form>
      <div id="initial">
        <div id="controls0"
          style="display: flex; justify-content: center; flex-direction: row; align-items: center;">
          <button hidden id="playPauseButton0"
            class="wavesurfer-button btn btn-primary button"></button>
          <button hidden id="stopButton0" class="wavesurfer-button btn btn-primary"></button>
          <button hidden id="muteButton0" class="wavesurfer-button btn btn-primary"></button>
          <button hidden id="playButton0" class="wavesurfer-button btn btn-primary"></button>
          <button hidden id="pauseButton0" class="wavesurfer-button btn btn-primary"></button>
          <span id='playback_speed' style="padding-left: 30px; padding-right: 15px;"> Playback
            speed:</span>
          <input type="range" min="10" max="200" step="10" value="100" class="slider"
            id="speedSlider" oninput="setSpeed(this.value)">
          <span id='speedValue' style="padding-left: 10px;"> 100% </span>
        </div>
        <div id="waveform0"> <!-- The waveform to follow will be here (after the buttons)-->
          <div class="container">
          </div>
        </div>
        <div id="timeline0">
        </div>
      </div>
    </div>
    <div>
      <div id="mic-waveform-display">
        <div class="container">
          <div id="mic-wave"></div>
        </div>
      </div>
      <p></p>
      <p></p>
      <p><strong>Recordings:</strong></p>
      <p></p>
      <ol id="recordingsList"></ol>
  </center>

  <!-- inserting these scripts at the end to be able to use all the elements in the DOM -->
  <!--<script src="js/metro.js"></script>-->

  <!--public scripts follow-->
  <script src="/js/soundtouch.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/wavencoder/2.0.1/wavencoder.min.js"></script>
  <script src="/js/recorder.js"></script>
  <script src="/js/wavesurfer.js"></script>
  <script src="/js/wavesurfer.cursor.js"></script>
  <script src="/js/wavesurfer.microphone.min.js"></script>
  <script src="/js/wavesurfer.timeline.js"></script>
  <!-- application script -->
  <script src="/js/app.js"></script>

  <script>
    function setSpeed(s) {
      setPlaybackSpeed(s);
      document.getElementById('speedValue').innerHTML = s + " %";
    }
  </script>

</body>

</html>
